
# **"Samba on Oracle Linux 9: Secure File Sharing for Mixed Environments"**

> *Enable secure, controlled file sharing across Windows and Linux clients using Samba. This guide walks you through a real-world setup with group permissions, SELinux, and access control.*

---

## üß≠ **1. Introduction**
- So I am showing my gray hairs on this one but Samba one of the first Open Source products I heard of before I even know what Linux was.
- I was working for a small company right out of unvisity and the system administor set it up for the company to use for shared drives
- Fast forward to today, though we have cloud option on-premises files shares are still alive today.
- If a Linux distro doesn't install Samba be default it is still part of some install option and part of core repos so Samba is still a mainstream applciation
- But what does it do?
---

## üì¶ **2. What is Samba?**
- Samba start as a way to centrize file when hard drive space was costly on the end user devices
- With a few extra hard drives, a Linux distro and pantsion back then, a Samba server could be thrown together
- Now a days, it is that home media server, stream media to smart TV, phones and tablet.
- You may even store you tax returns on that server, but encrypted right?
- If you bought an off of the shelf NAS, it could be running Samba, so like IOT and Linux, you maybe suprise where Samba still is.

---

## üõ†Ô∏è Samba Setup: Layers to Watch

Setting up Samba can be challenging because it touches multiple parts of your system:

* Linux file permissions
* Samba user and password settings
* PAM modules (optional)
* SELinux or AppArmor restrictions
* Firewall access

> These layers may cause confusion‚Äîbut they also make Samba highly secure when configured properly.

---

### üñ•Ô∏è **3. Setup Environment**

* OS: Oracle Linux 9 (RHEL-compatible)
* Services: `smb`, `nmb`
* Security: SELinux enforcing, firewalld active

---

### üõ†Ô∏è **4. Install Samba and Start Services**

```bash
sudo dnf install samba samba-client samba-common -y
sudo systemctl enable --now smb nmb
sudo firewall-cmd --permanent --add-service=samba
sudo firewall-cmd --reload
```

---

### üóÇÔ∏è **5. Plan and Create Share Structure**

```bash
/srv/samba/
‚îú‚îÄ‚îÄ shared/   # Collaborative team access
‚îî‚îÄ‚îÄ secure/   # Restricted access for sensitive data
```

```bash
sudo mkdir -p /srv/samba/shared /srv/samba/secure
```

---

### üë• **6. Set Up Users and Groups**

```bash
# Create users
sudo useradd smbuser
sudo smbpasswd -a smbuser

# Optional: Create additional users/groups
sudo groupadd finance
sudo usermod -aG finance smbuser

# Assign group ownership
sudo chown :finance /srv/samba/secure
sudo chmod 770 /srv/samba/secure
```

---

### ‚öôÔ∏è **7. Configure `smb.conf` for Secure and Open Shares**

```ini
[global]
   workgroup = WORKGROUP
   security = user
   map to guest = Bad User

[Shared]
   path = /srv/samba/shared
   browsable = yes
   writable = yes
   guest ok = yes
   read only = no

[SecureShare]
   path = /srv/samba/secure
   valid users = @finance
   guest ok = no
   writable = yes
```

```bash
sudo systemctl restart smb
```

---

### üõ°Ô∏è **8. SELinux Integration**

Explain how SELinux blocks unauthorized Samba access by default.

```bash
sudo semanage fcontext -a -t samba_share_t "/srv/samba(/.*)?"
sudo restorecon -Rv /srv/samba
```

> ‚ö†Ô∏è **Note:** You likely do *not* need to enable `samba_export_all_rw`. Using `semanage` and `samba_share_t` is more secure and preferred.

---

### üß™ **9. Test Share Access**

#### From Linux:

```bash
smbclient -L //<server-ip> -U smbuser
smbclient //192.168.35.42/SecureShare -U smbuser
```

#### From Windows:

Open `\\<server-ip>\SecureShare` and login with the Samba credentials.

---

### üß∞ **10. Troubleshooting**

| Error                        | Cause                | Fix                                              |
| ---------------------------- | -------------------- | ------------------------------------------------ |
| `NT_STATUS_BAD_NETWORK_NAME` | Incorrect share name | Match exactly as in `smb.conf`                   |
| `NT_STATUS_ACCESS_DENIED`    | Wrong user or perms  | Ensure user is in `valid users`, has file access |
| Cannot access share          | SELinux denial       | Set `samba_share_t` context                      |

Check logs:

```bash
sudo tail -f /var/log/samba/log.smbd
```

---

### ‚úÖ **11. Conclusion**

* You‚Äôve now built a **secure, business-ready Samba setup**.
* Introduced secure shares, SELinux config, group-based access.
* Ready for next steps: **ACLs**, **AD integration**, or **audit logging**.

---

Would you like this outline converted into full Markdown/HTML post format now? Or want a separate short tutorial version (like for social or newsletter use)?


## üõ°Ô∏è Security Considerations

| Concern                 | Action                                                |
| ----------------------- | ----------------------------------------------------- |
| **Guest Access**        | Disable for production; use authenticated users only  |
| **SELinux Contexts**    | Use `chcon -t samba_share_t /your/share` or setsebool |
| **Firewall Zones**      | Ensure Samba is allowed **only** in trusted zones     |
| **SMB Version Control** | Use `min protocol = SMB2` in `[global]` section       |
| **User Access Control** | Limit with `valid users` and filesystem permissions   |

---

## üìã Test Checklist

| Test                    | Command                                          |
| ----------------------- | ------------------------------------------------ |
| Verify share is visible | `smbclient -L //<server-ip>`                     |
| Connect anonymously     | `smbclient //<server-ip>/Shared -U guest`        |
| Connect with user       | `smbclient //<server-ip>/SecureShare -U smbuser` |
| View logs               | `sudo tail -f /var/log/samba/log.smbd`           |

---

## ‚úÖ Conclusion

This guide covered:

* What Samba is and why it matters to business users
* How to install it securely on Oracle Linux 9
* How to configure both open and authenticated shares
* Key security steps for real-world environments

> *Follow-up articles will cover:*
>
> * Hardening Samba with SELinux and minimal protocol versions
> * Integrating with Active Directory
> * Using Samba as a domain controller

---

## üßæ Optional Appendix: Samba Service Quick Commands

```bash
# Start/stop/restart
sudo systemctl start smb
sudo systemctl stop nmb
sudo systemctl restart smb

# Test config syntax
testparm

# List current shares
smbclient -L localhost -U%

# Connect to share
smbclient //localhost/Shared -U guest
```

---

Would you like this exported to Markdown or would you like help turning this into a multi-part series like your CUPS articles?
