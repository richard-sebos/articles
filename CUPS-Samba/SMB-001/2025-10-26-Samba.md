
# **"Samba on Oracle Linux 9: Secure File Sharing for Mixed Environments"**

> *Enable secure, controlled file sharing across Windows and Linux clients using Samba. This guide walks you through a real-world setup with group permissions, SELinux, and access control.*

---

# üß∞ Introduction to Samba

I might be showing my gray hairs here, but *Samba* was one of the first open source projects I ever heard about‚Äîwell before I even knew what Linux was.

Back then, I was fresh out of university, working at a small company where the system administrator had set up a Samba server for shared drives across the office. It was one of those ‚ÄúLinux can do that?‚Äù moments that stuck with me.

Fast forward to today: even in the age of cloud storage and SaaS platforms, **on-premises file shares are still very much alive**. Samba continues to be relevant, shipping by default with many Linux distributions or available via core package repositories. Whether you're deploying a small home server or maintaining enterprise file services, Samba remains a key tool in the sysadmin‚Äôs toolkit.

But what exactly *is* Samba?

---

## üì¶ What Is Samba?

Originally, **Samba** was created to centralize file storage in environments where local disk space was limited and expensive. With a few extra hard drives, a Linux distro, and a bit of patience, you could spin up a Samba server to serve files over the network using Windows-compatible protocols.

Today, Samba is everywhere‚Äîeven if you don‚Äôt realize it:

* It powers **home media servers**, streaming movies and music to smart TVs, tablets, and phones.
* It serves as **centralized file storage** for workgroups and small businesses.
* It‚Äôs even the software layer behind many off-the-shelf **NAS appliances**, quietly running in the background.

If you own a smart device, a NAS, or even an IoT gadget that offers SMB/CIFS file sharing, there‚Äôs a good chance Samba is under the hood.

---

## üõ†Ô∏è Samba Setup: Layers to Watch

Samba is one of those applications that touches **multiple layers of system security**. Even with a perfect `smb.conf` file, things can still break in unexpected ways.

I‚Äôve spent hours reviewing configuration files in the past, only to discover the issue wasn‚Äôt in Samba at all‚Äîit was something deeper in the stack: a missed firewall rule, a mismatched file permission, or an SELinux policy silently blocking access.

These layers can be frustrating, but they also make Samba **incredibly secure when configured correctly**.

Before you start a new Samba setup, make sure you‚Äôve accounted for the following:

* üî• **Firewall:** Are the required ports open (`137`, `138`, `139`, `445`)?
* üë§ **Linux User Account:** Does the user exist on the system?
* üîê **Samba User Account:** Has the user been added to the Samba password database (`smbpasswd`)?
* üß© **PAM Integration:** Is PAM (Pluggable Authentication Modules) affecting authentication?
* üõ°Ô∏è **SELinux / AppArmor:** Are any security policies interfering with access?
* üìÅ **Filesystem Permissions:** Are the directory and file permissions correctly mapped?

Taking the time to plan around these layers up front will make the setup **smoother and more predictable**‚Äîand will save you hours of troubleshooting later.

> üßô‚Äç‚ôÇÔ∏è **To all the Samba veterans out there**‚Äîdid I miss something?

---

### üñ•Ô∏è **3. Setup Environment**

* OS: Oracle Linux 9 (RHEL-compatible)
* Services: `smb`, `nmb`
* Security: SELinux enforcing, firewalld active

---

### üõ†Ô∏è **4. Install Samba and Start Services**

```bash
sudo dnf install samba samba-client samba-common -y
sudo systemctl enable --now smb nmb
sudo firewall-cmd --permanent --add-service=samba
sudo firewall-cmd --reload
```

---

### üóÇÔ∏è **5. Plan and Create Share Structure**

```bash
/srv/samba/
‚îú‚îÄ‚îÄ shared/   # Collaborative team access
‚îî‚îÄ‚îÄ secure/   # Restricted access for sensitive data
```

```bash
sudo mkdir -p /srv/samba/shared /srv/samba/secure
```

---

### üë• **6. Set Up Users and Groups**

```bash
# Create users
sudo useradd smbuser
sudo smbpasswd -a smbuser

# Optional: Create additional users/groups
sudo groupadd finance
sudo usermod -aG finance smbuser

# Assign group ownership
sudo chown :finance /srv/samba/secure
sudo chmod 770 /srv/samba/secure
```

---

### ‚öôÔ∏è **7. Configure `smb.conf` for Secure and Open Shares**

```ini
[global]
   workgroup = WORKGROUP
   security = user
   map to guest = Bad User

[Shared]
   path = /srv/samba/shared
   browsable = yes
   writable = yes
   guest ok = yes
   read only = no

[SecureShare]
   path = /srv/samba/secure
   valid users = @finance
   guest ok = no
   writable = yes
```

```bash
sudo systemctl restart smb
```

---

### üõ°Ô∏è **8. SELinux Integration**

Explain how SELinux blocks unauthorized Samba access by default.

```bash
sudo semanage fcontext -a -t samba_share_t "/srv/samba(/.*)?"
sudo restorecon -Rv /srv/samba
```

> ‚ö†Ô∏è **Note:** You likely do *not* need to enable `samba_export_all_rw`. Using `semanage` and `samba_share_t` is more secure and preferred.

---

### üß™ **9. Test Share Access**

#### From Linux:

```bash
smbclient -L //<server-ip> -U smbuser
smbclient //192.168.35.42/SecureShare -U smbuser
```

#### From Windows:

Open `\\<server-ip>\SecureShare` and login with the Samba credentials.

---

### üß∞ **10. Troubleshooting**

| Error                        | Cause                | Fix                                              |
| ---------------------------- | -------------------- | ------------------------------------------------ |
| `NT_STATUS_BAD_NETWORK_NAME` | Incorrect share name | Match exactly as in `smb.conf`                   |
| `NT_STATUS_ACCESS_DENIED`    | Wrong user or perms  | Ensure user is in `valid users`, has file access |
| Cannot access share          | SELinux denial       | Set `samba_share_t` context                      |

Check logs:

```bash
sudo tail -f /var/log/samba/log.smbd
```

---

### ‚úÖ **11. Conclusion**

* You‚Äôve now built a **secure, business-ready Samba setup**.
* Introduced secure shares, SELinux config, group-based access.
* Ready for next steps: **ACLs**, **AD integration**, or **audit logging**.

---

Would you like this outline converted into full Markdown/HTML post format now? Or want a separate short tutorial version (like for social or newsletter use)?


## üõ°Ô∏è Security Considerations

| Concern                 | Action                                                |
| ----------------------- | ----------------------------------------------------- |
| **Guest Access**        | Disable for production; use authenticated users only  |
| **SELinux Contexts**    | Use `chcon -t samba_share_t /your/share` or setsebool |
| **Firewall Zones**      | Ensure Samba is allowed **only** in trusted zones     |
| **SMB Version Control** | Use `min protocol = SMB2` in `[global]` section       |
| **User Access Control** | Limit with `valid users` and filesystem permissions   |

---

## üìã Test Checklist

| Test                    | Command                                          |
| ----------------------- | ------------------------------------------------ |
| Verify share is visible | `smbclient -L //<server-ip>`                     |
| Connect anonymously     | `smbclient //<server-ip>/Shared -U guest`        |
| Connect with user       | `smbclient //<server-ip>/SecureShare -U smbuser` |
| View logs               | `sudo tail -f /var/log/samba/log.smbd`           |

---

## ‚úÖ Conclusion

This guide covered:

* What Samba is and why it matters to business users
* How to install it securely on Oracle Linux 9
* How to configure both open and authenticated shares
* Key security steps for real-world environments

> *Follow-up articles will cover:*
>
> * Hardening Samba with SELinux and minimal protocol versions
> * Integrating with Active Directory
> * Using Samba as a domain controller

---

## üßæ Optional Appendix: Samba Service Quick Commands

```bash
# Start/stop/restart
sudo systemctl start smb
sudo systemctl stop nmb
sudo systemctl restart smb

# Test config syntax
testparm

# List current shares
smbclient -L localhost -U%

# Connect to share
smbclient //localhost/Shared -U guest
```

---

Would you like this exported to Markdown or would you like help turning this into a multi-part series like your CUPS articles?
