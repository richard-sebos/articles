
# ESP32 Debug Helper for macOS (with MicroPython)

- As a Linux Admin, I spend a lot of time on the commandline.
- When I wanted to get into ESP32 programming again, I installed the Arduino but quickly wanted to find a different way to interact with the ESP32s
- This has nothing to do with the Arduino software, which would work fine but more with how I like to work.
- I was also going to be programming with MicroPython do it seem like a greate fit.

## mpremote
- mpremote is a MicroPython remote control utility to interact with an ESP32
- mpremote because a handy tool and soon I had a text editor open and was copy and pasting lines but I was looking for something simpler in the long run
```
pip install mpremote pyseria esptool
```
- It can be used to:
  - erase and flash MircoPython to ESP32
  - copy files
  - run files on a ESP32
  - As well as other task.
- I've found I can me more affective when orginized and even though the I have everything in a text pad, it was taking more time than I wanted.
- I create a script called `esp_debug.sh` so I could get into a MircoPython shell on the ESP32 and it grow from there.

## `esp_debug.sh`
- After playing with `esp_debug.sh` for a bit, the first thing it does now is to look to see if an ESP32 is plugged in.
- It uses a shell function `detect_port.sh` to find the `/dev/` for the ESP and then gettting the type from `show_chip_type.sh` and it sets the ESP32 type
- `esp_debug.sh` uses `data\serial_index.sh` for common ESP32 mount pounts
- From there it provides a shell menu
```bash
~/esp32/esp_debug.sh
[INFO] Using port: /dev/cu.usbserial-210
----------------------------------------------------------------
Detecting ESP chip type
----------------------------------------------------------------
[INFO] Detected chip: ESP32 (raw: ESP32-D0WD-V3)
[INFO] CHIP_TYPE set to: ESP32
--menu

ESP32 Debug Menu (port: /dev/cu.usbserial-210, chip: ESP32)
  1) Serial monitor
  3) Diagnostics snapshot
  4) Soft reset
  5) Run main.py
  6) Hard reset instructions
  f) Flash firmware
  u) Upload code to device
  q) Quit

```
- From the menu, I do most of the programming of the ESP32 with those shell scripts
```
esp32/
├── esp_debug.sh         # main script
├── micropython/         # firmware storage (optional)
├── functions/           # sourced helper functions
├── data/
```

## Flash Firmware
- `Flash Fireware` to start uses esptool erase-flash to erase the entire flash memory of the ESP32.
> Note:
>
> It will remove prior programming so make user you are ready for that
> 
- after erasing memory, it flashed a copy of MircoPython base on the ESP32 type and what is stored in micropython directory
- now the ESP32 is ready to have code uploaded

## Upload Code
- I run `esp_debug` from project directory with `~/esp32/esp_debug.sh` and have the code to upload in a code directory from the project directory
- The `Upload code to device` uses `mpremote` to copy files to the ESP32
- It looks for a code directory from the current location and uploads all the files and directories from there
- Now the ESP32 is ready to run

##  Run main.py
- `Run main.py` does exactly that, runs the main.py on the ESP32 in a serial monitor
- If there are output statements printed outt to the serial monitor you will see them here
- This was the main reason I wanted to create `esp_debug.sh` so I could see if there were errors and what else was being outputed to the serial monitor
- It has become very helpfun

## Serial monitor
- `Serial monitor` will drop you into a Python shell on the ESP32 where you can run commands and do addtitonal debug
- It is also helpful for prototyping code since you can import individual modules/class and run code from there.
- I normally use this after I do a `Run main.py` to get additional information on how the code is working
> Note: Errors on the serial monitor will drop you out of the `esp_debug` program
> 
## Other Options
- I've included a few other option I use from time to time
- `Soft reset` which restarts the Python runtime  and rerunning boot.py
- `Diagnostics snapshot` which give the overstatus of the ESP32
- `Hard reset instructions` which display the hard reset instructions
- I will more features as I needed them

## Is this needed
- Do you need a tool like this to program an ESP32, no and it is probibly not the best one out there
- Why I like about it is, I can now just work on the code I an to generate and not try to remember the commands to program the ESP32

  
